---
title: 'Chat Server'
description: 'Chat Server'
summary: 'Chat server developed with Spring Boot, Websocket and Angular (Clarity) frontend'
date: '2021-11-12'
aliases: [/chat-server/]
author: 'Arjun Surendra'
categories: [WebSocket]
tags: [websocket, server-sent-event, angular, clarity, springboot]
toc: true
---

Chat Server developed with Spring Boot, Websocket and Angular (Clarity) frontend.

Github: [https://github.com/gitorko/project92](https://github.com/gitorko/project92)

## Quick Overview

To deploy the application in a single command, clone the project, make sure no conflicting docker containers or ports are running and then run

```bash
git clone https://github.com/gitorko/project92
cd project92
docker-compose -f docker/docker-compose.yml up 
```

## Requirements

Realtime data fetch from server via bi-directional communication is one of the key requirements for a chat server. To fetch information from the server continuously we can use the following approaches.

* Short Polling - Periodic polling from the client. Costly.
* Long Polling - Poll from client but server responds only when it has data.
* Server-Sent Events (SSE) - Half duplex channel to send one way data. Client subscribes to a stream of events generated by a server, receiving updates whenever a new event occurs. Keeps the HTTP stream connection and keeps the connection open. Server pushes the events to the client. Transported over simple HTTP instead of a custom protocol. Does not support binary data.
* WebSockets -  Full duplex 2 way channel to send and receive data.
* HTTP/2 - Multiple data stream in a single connection via Request multiplexing, header compression reduces size. Works at browser level & not application. Loads entire resources, not bits of application data

| Websocket                 | Http/2                   | Server Send Event        | Long-Poll                  |
|---------------------------|--------------------------|--------------------------|----------------------------|
| Full-duplex               | Half-duplex              | Half-duplex              | Half-duplex                |
| Bidirectional             | Unidirectional           | Unidirectional           | Unidirectional             |
| Text + Binary             | Text + Binary            | Text                     | Text + Binary              |
| 1024 parallel connections | 6-8 parallel connections | 6-8 parallel connections | Based on threads available |

1. Connect will open the websocket connection & disconnect should terminate the session.
2. Two users should be able to send and receive messages.

## Design

![](img01.png)
![](img02.png)

## Code

You can enable plain websockets via @EnableWebSocket however in the example below we are using STOMP over WebSocket protocol by using @EnableWebSocketMessageBroker. STOMP is a subprotocol operating on top of the lower-level WebSocket. Here we create an in-memory message broker for sending and receiving messages.
Instead of the annotation @SendTo, you can also use SimpMessagingTemplate which you can autowire inside your controller.

{{< ghcode "https://raw.githubusercontent.com/gitorko/project92/main/src/main/java/com/demo/project92/controller/HomeController.java" >}}
{{< ghcode "https://raw.githubusercontent.com/gitorko/project92/main/src/main/java/com/demo/project92/config/WebSocketConfig.java" >}}
{{< ghcode "https://raw.githubusercontent.com/gitorko/project92/main/ui/src/app/home/home.component.html" >}}
{{< ghcode "https://raw.githubusercontent.com/gitorko/project92/main/ui/src/app/home/home.component.ts" >}}

## Setup

{{< markcode "https://raw.githubusercontent.com/gitorko/project92/main/README.md" >}}

## References

[https://spring.io/guides/gs/messaging-stomp-websocket/](https://spring.io/guides/gs/messaging-stomp-websocket/)

[https://linuxhint.com/websockets-http-2-sse-compared/](https://linuxhint.com/websockets-http-2-sse-compared/)

[https://www.toptal.com/java/stomp-spring-boot-websocket](https://www.toptal.com/java/stomp-spring-boot-websocket)
